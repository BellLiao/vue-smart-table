<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="UTF-8">
    <title>Vue-smart-table by gurghet</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.1.8/semantic.min.css" media="all">
    <style>
        #app {
            display: flex;
            justify-content: center;
        }
        .smart-table {
            margin: 20px;
        }
    </style>
</head>
<body>
<div id="app">
    <smart-table
            table-classes="ui celled table unstackable"
            :auto-load="true"
            body-path="results"
            id-col="id.value"
            endpoint="http://api.randomuser.me/?page=1&results=20"
            :header="[
            {key: 'name.first', label: 'name'},
            {key: 'name.last', label: 'surname'},
            {key: 'gender'},
            {key: 'phone+cell', label: 'contacts'},
            {key: 'picture.thumbnail', label: 'avatar'},
            {key: 'nat', label: 'nationality'}
            ]"
            :order-by="['name.first', 'name.last']"
    >

        <fontawesome slot="gender"></fontawesome>
        <!-- this component is pretty self
             explanatory, it will turn the string
             into the specified icon -->

        <contacts slot="phone+cell"></contacts>
        <!-- phone+cell is a derived column,
             this component is just a <div> tag to
             display 2 lines-->

        <src2img slot="picture.thumbnail"></src2img>
        <!-- this component will read the image
             address inside the nested json
             object and put it into the scr of
             an img tag -->

        <nationality slot="nat"></nationality>
        <!-- this component will take the country
             iso code from the json, query
             a web service and overwrite itself with
             the full country name! -->
    </smart-table>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/1.0.26/vue.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/vue-resource/0.8.0/vue-resource.js"></script>
<script src="https://npmcdn.com/vue-smart-table@2.4.3/dist/static/vue-smart-table.js"></script>
<script>
    new Vue({el: '#app'})

    Vue.component('fontawesome', {
        template: ' <i class="fa fa-{{value}}" aria-hidden="true"></i>',
        created: function () {injectFontAwesome()}
    })

    Vue.component('contacts', {
        template: "<div>tel. {{value ? value.phone : ''}}<br/>cell. {{value ? value.cell : ''}}</div>"
    })

    Vue.component('src2img', {
        template: '<img :src="value"></img>'
    })

    Vue.component('nationality', {
        template: "<p>{{value}}</p>",
        watch: {
            'value' (val) {
                if (val.length !== 2) { return }
                this.$http.get('https://restcountries.eu/rest/v1/alpha/' + val)
                        .then(function(res) { this.$set('value', res.data.name) })
            }
        }
    })

    function injectFontAwesome() {
        // avoid duplicates
        for (var i = 0; i < document.styleSheets.length; i++) {
            if (document.styleSheets[i].href === href) {
                return
            }
        }
        var head = document.getElementsByTagName('head')[0]
        var link = document.createElement('link')
        link.rel = 'stylesheet'
        link.type = 'text/css'
        var href = 'https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css'
        link.href = href
        head.appendChild(link)
    }
</script>
</body>
</html>
